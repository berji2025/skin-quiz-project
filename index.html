<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berji您的肌膚管理小助手</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入 html2canvas 用於將網頁轉為圖片 -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        :root {
            --primary: #ffb6c1;
            --secondary: #ffccd5;
            --accent: #ff7bac;
            --dark: #5a4a4f;
            --light: #fff5f7;
            --text: #333333;
            --shadow: rgba(0, 0, 0, 0.08);
            --success: #4CAF50;
            --line-green: #06C755;
            --info: #2196F3;
            --warning: #FF9800;
        }
        
        body {
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white" opacity="0.1"/></svg>');
        }
        
        .logo {
            font-size: 3.5rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tagline {
            font-size: 1.2rem;
            color: white;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .section-title {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: -3px;
            width: 80px;
            height: 3px;
            background-color: var(--accent);
        }
        
        .card {
            background-color: white;
            border-radius: 18px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .question-container {
            display: none;
        }
        
        .question-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .question {
            font-size: 1.4rem;
            margin-bottom: 25px;
            color: var(--dark);
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .option {
            padding: 18px 20px;
            background-color: #f9f9f9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #f0f0f0;
        }
        
        .option:hover {
            background-color: var(--secondary);
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--accent);
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(255, 123, 172, 0.3);
            flex: 1;
            min-width: 150px;
        }
        
        .btn:hover {
            background-color: #ff5a94;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 123, 172, 0.4);
        }
        
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--accent);
            border: 2px solid var(--accent);
            box-shadow: none;
        }
        
        .btn-outline:hover {
            background-color: var(--accent);
            color: white;
        }
        
        .results-container {
            display: none;
        }
        
        .skin-type {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(to right, #fff5f7, white);
            border-radius: 15px;
            border-left: 8px solid var(--accent);
        }
        
        .skin-icon {
            font-size: 4rem;
            color: var(--accent);
            margin-right: 30px;
        }
        
        .skin-info h3 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .skin-info p {
            font-size: 1.1rem;
            color: #666;
        }
        
        .advice-section {
            margin-top: 40px;
        }
        
        .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .advice-card {
            padding: 25px;
            border-radius: 15px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 5px solid var(--primary);
        }
        
        .advice-card h4 {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .advice-card h4 i {
            color: var(--accent);
        }
        
        .personality-section {
            background: linear-gradient(to right, #f8f4ff, #fff5f9);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 8px solid #c8a2c8;
        }
        
        .blessing {
            text-align: center;
            padding: 25px;
            background: linear-gradient(to right, #ffccd5, #ffb6c1);
            border-radius: 15px;
            margin-top: 30px;
            color: white;
        }
        
        .blessing h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .blessing-text {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 20px 0;
            min-height: 40px;
        }
        
        /* 結果下載區域 - 更新樣式 */
        #results-download {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            border: 2px dashed var(--accent);
            display: none; /* 初始隱藏 */
        }
        
        #results-download h3 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        #results-download p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 25px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .download-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        .download-option {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .download-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }
        
        .download-option i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .download-option.txt i {
            color: var(--success);
        }
        
        .download-option.png i {
            color: var(--info);
        }
        
        .download-option.html i {
            color: var(--warning);
        }
        
        .download-option h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .download-option p {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .download-button {
            padding: 12px 25px;
            background-color: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            width: 100%;
            display: block;
        }
        
        .download-button:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 123, 172, 0.3);
        }
        
        .download-button.txt {
            background-color: var(--success);
        }
        
        .download-button.png {
            background-color: var(--info);
        }
        
        .download-button.html {
            background-color: var(--warning);
        }
        
        .download-note {
            font-size: 0.9rem;
            color: #888;
            margin-top: 20px;
            font-style: italic;
        }
        
        /* Line推廣區域 */
        #line-promotion {
            background: linear-gradient(135deg, #e6f7ed 0%, #d4f1df 100%);
            border-radius: 15px;
            padding: 35px;
            margin-top: 40px;
            border-left: 8px solid var(--line-green);
            display: none; /* 初始隱藏 */
        }
        
        #line-promotion .line-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        #line-promotion h2 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        #line-promotion p {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .line-id {
            background-color: #fff;
            padding: 5px 15px;
            border-radius: 30px;
            font-weight: bold;
            color: var(--line-green);
            border: 2px solid var(--line-green);
            font-size: 1.2rem;
        }
        
        .line-button {
            display: inline-block;
            padding: 18px 35px;
            background-color: var(--line-green);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(6, 199, 85, 0.3);
            margin-top: 15px;
        }
        
        .line-button:hover {
            background-color: #05a944;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(6, 199, 85, 0.4);
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            color: #888;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-animation {
            animation: fadeIn 0.8s ease;
        }
        
        .toggle-advanced {
            text-align: center;
            margin: 20px 0;
        }
        
        .toggle-btn {
            background: transparent;
            border: none;
            color: var(--accent);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 auto;
            padding: 10px 20px;
            border-radius: 50px;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background-color: rgba(255, 123, 172, 0.1);
        }
        
        .advanced-questions {
            display: none;
        }
        
        .advanced-questions.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* 下載加載動畫 */
        .download-loading {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .advice-grid {
                grid-template-columns: 1fr;
            }
            
            .skin-type {
                flex-direction: column;
                text-align: center;
            }
            
            .skin-icon {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            #line-promotion h2 {
                font-size: 1.5rem;
            }
            
            .line-button {
                padding: 15px 25px;
                font-size: 1rem;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .download-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-spa"></i>
            </div>
            <h1>Berji您的肌膚管理小助手</h1>
            <p class="tagline">想知道你的「膚質人格」是什麼嗎？3分鐘完成線上肌膚檢測，獲取專屬護理攻略，還能領取專屬好禮！</p>
        </header>
        
        <div class="card">
            <h2 class="section-title">肌膚檢測</h2>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span>檢測進度</span>
                    <span id="progressText">0/6</span>
                </div>
            </div>
            
            <div id="questionContainer">
                <!-- 問題會動態插入這裡 -->
            </div>
            
            <div class="toggle-advanced">
                <button class="toggle-btn" id="toggleAdvanced">
                    <i class="fas fa-plus-circle"></i>
                    <span>進階檢測（皮膚狀態分析）</span>
                </button>
            </div>
            
            <div class="advanced-questions" id="advancedQuestions">
                <!-- 進階問題會動態插入這裡 -->
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-outline" id="prevBtn">
                    <i class="fas fa-arrow-left"></i>
                    上一題
                </button>
                <button class="btn" id="nextBtn">
                    下一題
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn" id="submitBtn" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    查看檢測結果
                </button>
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div class="card result-animation" id="resultCard">
                <h2 class="section-title">您的肌膚檢測結果</h2>
                
                <div class="skin-type" id="skinTypeResult">
                    <!-- 皮膚類型結果會插入這裡 -->
                </div>
                
                <div class="advice-section">
                    <h3 class="section-title">護膚建議</h3>
                    <div class="advice-grid" id="skincareAdvice">
                        <!-- 護膚建議會插入這裡 -->
                    </div>
                </div>
                
                <div class="advice-section">
                    <h3 class="section-title">飲食建議</h3>
                    <div class="advice-grid" id="dietAdvice">
                        <!-- 飲食建議會插入這裡 -->
                    </div>
                </div>
                
                <div class="personality-section" id="personalityResult">
                    <!-- 人格分析會插入這裡 -->
                </div>
                
                <!-- 更新後的下載區域 -->
                <section id="results-download">
                    <h3><i class="fas fa-download"></i> 下載您的專屬結果</h3>
                    <p>選擇您想要的格式下載或保存您的分析結果：</p>
                    
                    <div class="download-options">
                        <div class="download-option txt">
                            <i class="fas fa-file-alt"></i>
                            <h4>文字檔 (.txt)</h4>
                            <p>純文字格式，體積小，適合快速查看</p>
                            <button class="download-button txt" id="downloadTxtBtn">
                                <i class="fas fa-download"></i> 下載文字檔
                            </button>
                        </div>
                        
                        <div class="download-option png">
                            <i class="fas fa-image"></i>
                            <h4>圖片檔 (.png)</h4>
                            <p>高品質圖片，適合分享到社群媒體</p>
                            <button class="download-button png" id="downloadPngBtn">
                                <i class="fas fa-download"></i> 下載圖片
                            </button>
                        </div>
                        
                        <div class="download-option html">
                            <i class="fas fa-code"></i>
                            <h4>完整網頁 (.html)</h4>
                            <p>獨立HTML檔案，保留完整格式</p>
                            <button class="download-button html" id="downloadHtmlBtn">
                                <i class="fas fa-download"></i> 下載網頁
                            </button>
                        </div>
                    </div>
                    
                    <div class="download-loading" id="downloadLoading">
                        <div class="loading-spinner"></div>
                        <p>正在生成檔案，請稍候...</p>
                    </div>
                    
                    <p class="download-note">
                        <i class="fas fa-info-circle"></i> 提示：您也可以直接使用瀏覽器的「列印」功能 (Ctrl+P) 將此頁面保存為PDF
                    </p>
                </section>
                
                <div class="blessing">
                    <h3><i class="fas fa-heart"></i> Berji的祝福</h3>
                    <p class="blessing-text" id="blessingText"></p>
                    <button class="btn" id="newBlessingBtn">
                        <i class="fas fa-redo"></i>
                        獲取新的祝福
                    </button>
                </div>
                
                <aside id="line-promotion">
                    <div class="line-content">
                        <h2><i class="fab fa-line"></i> 加入 Line 好友，領你的專屬優惠好禮！</h2>
                        <p>立即點擊下方按鈕加入好友，並在 Line 輸入 ：<mark class="line-id">hyjfjc88</mark> 領取您的專屬好禮！</p>

                        <a href="https://lin.ee/osrHn6D" target="_blank" class="line-button">
                            <i class="fab fa-line"></i> 加入line好友輸入hyjfjc88領取你的專屬優惠好禮
                        </a>
                        
                        <p style="margin-top: 20px; font-size: 0.95rem; color: #666;">
                            <i class="fas fa-info-circle"></i> 加入後請記得輸入優惠碼: <strong>hyjfjc88</strong>
                        </p>
                    </div>
                </aside>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-outline" id="restartBtn">
                        <i class="fas fa-redo-alt"></i>
                        重新檢測
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Berji肌膚您的管理小助手 &copy; 2023 | 本檢測結果僅供參考，如有皮膚問題請諮詢專業醫師</p>
        </footer>
    </div>

    <script>
        // 問題數據 (與之前相同，省略重複部分以節省空間)
        const basicQuestions = [
            // ... (與原始程式碼完全相同)
        ];

        const advancedQuestions = [
            // ... (與原始程式碼完全相同)
        ];

        const skinTypeResults = {
            // ... (與原始程式碼完全相同)
        };

        const skincareAdvice = {
            // ... (與原始程式碼完全相同)
        };

        const dietAdvice = {
            // ... (與原始程式碼完全相同)
        };

        const blessings = [
            // ... (與原始程式碼完全相同)
        ];

        // 應用狀態
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let advancedAnswers = {};
        let showAdvanced = false;
        let skinType = "";
        let userResults = {};

        // DOM元素
        const questionContainer = document.getElementById('questionContainer');
        const advancedQuestionsContainer = document.getElementById('advancedQuestions');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const toggleAdvancedBtn = document.getElementById('toggleAdvanced');
        const resultsContainer = document.getElementById('resultsContainer');
        const skinTypeResult = document.getElementById('skinTypeResult');
        const skincareAdviceContainer = document.getElementById('skincareAdvice');
        const dietAdviceContainer = document.getElementById('dietAdvice');
        const personalityResult = document.getElementById('personalityResult');
        const blessingText = document.getElementById('blessingText');
        const newBlessingBtn = document.getElementById('newBlessingBtn');
        const restartBtn = document.getElementById('restartBtn');
        const resultCard = document.getElementById('resultCard');
        const resultsDownloadSection = document.getElementById('results-download');
        const linePromotionSection = document.getElementById('line-promotion');
        const downloadLoading = document.getElementById('downloadLoading');
        
        // 新增的下載按鈕
        const downloadTxtBtn = document.getElementById('downloadTxtBtn');
        const downloadPngBtn = document.getElementById('downloadPngBtn');
        const downloadHtmlBtn = document.getElementById('downloadHtmlBtn');

        // 初始化
        function init() {
            displayQuestion(currentQuestionIndex);
            updateProgress();
            generateBlessing();
            
            // 事件監聽
            prevBtn.addEventListener('click', goToPreviousQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            submitBtn.addEventListener('click', submitTest);
            toggleAdvancedBtn.addEventListener('click', toggleAdvancedQuestions);
            newBlessingBtn.addEventListener('click', generateBlessing);
            restartBtn.addEventListener('click', restartTest);
            
            // 新增的下載事件監聽
            downloadTxtBtn.addEventListener('click', downloadTxtResults);
            downloadPngBtn.addEventListener('click', downloadPngResults);
            downloadHtmlBtn.addEventListener('click', downloadHtmlResults);
        }

        // 顯示問題 (與之前相同，省略以節省空間)
        function displayQuestion(index) {
            // ... (與原始程式碼完全相同)
        }

        // 更新進度條 (與之前相同)
        function updateProgress() {
            // ... (與原始程式碼完全相同)
        }

        // 更新按鈕狀態 (與之前相同)
        function updateButtonStates() {
            // ... (與原始程式碼完全相同)
        }

        // 下一題 (與之前相同)
        function goToNextQuestion() {
            // ... (與原始程式碼完全相同)
        }

        // 上一題 (與之前相同)
        function goToPreviousQuestion() {
            // ... (與原始程式碼完全相同)
        }

        // 切換進階問題 (與之前相同)
        function toggleAdvancedQuestions() {
            // ... (與原始程式碼完全相同)
        }

        // 提交測驗
        function submitTest() {
            skinType = calculateSkinType();
            showResults();
            
            // 顯示下載和Line推廣區域
            resultsDownloadSection.style.display = 'block';
            linePromotionSection.style.display = 'block';
            
            // 滾動到結果區域頂部
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 計算皮膚類型 (與之前相同)
        function calculateSkinType() {
            // ... (與原始程式碼完全相同)
        }

        // 顯示結果 (與之前相同)
        function showResults() {
            // ... (與原始程式碼完全相同)
        }

        // 生成祝福語 (與之前相同)
        function generateBlessing() {
            // ... (與原始程式碼完全相同)
        }

        // 下載文字檔結果
        function downloadTxtResults() {
            showDownloadLoading(true);
            
            setTimeout(() => {
                const result = skinTypeResults[skinType];
                const now = new Date();
                const timestamp = now.toLocaleString('zh-TW');
                
                const txtContent = `
============================================
Berji肌膚您的管理小助手 - 檢測報告
生成時間: ${timestamp}
============================================

您的皮膚類型: ${result.name}

皮膚描述:
${result.description}

============================================
護膚建議:
============================================
${skincareAdvice[skinType].map(advice => `
${advice.title}:
${advice.content}
`).join('\n')}

============================================
飲食建議:
============================================
${dietAdvice[skinType].map(advice => `
${advice.title}:
${advice.content}
`).join('\n')}

============================================
膚質人格分析:
============================================
${result.personality}

============================================
Berji肌膚您的管理小助手祝您皮膚健康美麗！
                `;
                
                const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Berji肌膚檢測報告_${userResults.skinTypeName}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showDownloadSuccess(downloadTxtBtn);
                showDownloadLoading(false);
            }, 500);
        }

        // 下載圖片結果
        function downloadPngResults() {
            showDownloadLoading(true);
            
            // 使用html2canvas將結果區域轉換為圖片
            setTimeout(() => {
                const resultCardElement = document.getElementById('resultCard');
                
                // 設定選項
                const options = {
                    scale: 2, // 提高解析度
                    useCORS: true, // 允許跨域圖片
                    backgroundColor: '#fff5f7',
                    logging: false // 關閉日誌
                };
                
                html2canvas(resultCardElement, options).then(canvas => {
                    // 將canvas轉換為圖片URL
                    const image = canvas.toDataURL('image/png', 1.0);
                    
                    // 創建下載連結
                    const link = document.createElement('a');
                    const now = new Date();
                    const filename = `Berji肌膚檢測報告_${userResults.skinTypeName}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.png`;
                    
                    link.download = filename;
                    link.href = image;
                    link.click();
                    
                    showDownloadSuccess(downloadPngBtn);
                    showDownloadLoading(false);
                }).catch(error => {
                    console.error('生成圖片時發生錯誤:', error);
                    alert('生成圖片時發生錯誤，請稍後再試或選擇其他格式下載。');
                    showDownloadLoading(false);
                });
            }, 500);
        }

        // 下載完整HTML結果
        function downloadHtmlResults() {
            showDownloadLoading(true);
            
            setTimeout(() => {
                const now = new Date();
                const timestamp = now.toLocaleString('zh-TW');
                const result = skinTypeResults[skinType];
                
                // 建立完整的HTML內容
                const htmlContent = `
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berji肌膚檢測報告 - ${result.name}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff5f7;
        }
        
        .report-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #ffb6c1 0%, #ffccd5 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
        }
        
        .report-header h1 {
            margin-bottom: 10px;
        }
        
        .timestamp {
            font-style: italic;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            color: #5a4a4f;
            border-bottom: 2px solid #ffb6c1;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .skin-type-result {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(to right, #fff5f7, white);
            border-radius: 10px;
            border-left: 6px solid #ff7bac;
            margin-bottom: 20px;
        }
        
        .skin-icon {
            font-size: 3rem;
            color: #ff7bac;
            margin-right: 20px;
        }
        
        .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .advice-card {
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            border-top: 4px solid #ffb6c1;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="report-header">
        <h1><i class="fas fa-spa"></i> Berji肌膚檢測報告</h1>
        <p class="timestamp">報告生成時間: ${timestamp}</p>
    </div>
    
    <div class="section">
        <h2 class="section-title"><i class="fas fa-user-circle"></i> 檢測結果摘要</h2>
        
        <div class="skin-type-result">
            <div class="skin-icon"><i class="${result.icon}"></i></div>
            <div>
                <h3 style="margin: 0 0 10px 0; color: #5a4a4f;">${result.name}</h3>
                <p style="margin: 0; color: #666;">${result.description}</p>
            </div>
        </div>
        
        <h3><i class="fas fa-heart"></i> 膚質人格分析</h3>
        <p>${result.personality}</p>
    </div>
    
    <div class="section">
        <h2 class="section-title"><i class="fas fa-spa"></i> 護膚建議</h2>
        <div class="advice-grid">
            ${skincareAdvice[skinType].map(advice => `
            <div class="advice-card">
                <h4><i class="${advice.icon}"></i> ${advice.title}</h4>
                <p>${advice.content}</p>
            </div>
            `).join('')}
        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title"><i class="fas fa-utensils"></i> 飲食建議</h2>
        <div class="advice-grid">
            ${dietAdvice[skinType].map(advice => `
            <div class="advice-card">
                <h4><i class="${advice.icon}"></i> ${advice.title}</h4>
                <p>${advice.content}</p>
            </div>
            `).join('')}
        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title"><i class="fas fa-comment-heart"></i> 祝福語</h2>
        <p style="font-size: 1.2rem; font-style: italic; color: #666; padding: 15px; background-color: #fff0f3; border-radius: 8px;">
            "${blessingText.textContent}"
        </p>
    </div>
    
    <div class="footer">
        <p>Berji肌膚您的管理小助手 &copy; 2023</p>
        <p>本檢測結果僅供參考，如有皮膚問題請諮詢專業醫師</p>
    </div>
</body>
</html>
                `;
                
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Berji肌膚檢測報告_${userResults.skinTypeName}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showDownloadSuccess(downloadHtmlBtn);
                showDownloadLoading(false);
            }, 500);
        }

        // 顯示下載加載動畫
        function showDownloadLoading(show) {
            if (show) {
                downloadLoading.style.display = 'block';
                // 禁用所有下載按鈕
                document.querySelectorAll('.download-button').forEach(btn => {
                    btn.disabled = true;
                });
            } else {
                downloadLoading.style.display = 'none';
                // 啟用所有下載按鈕
                document.querySelectorAll('.download-button').forEach(btn => {
                    btn.disabled = false;
                });
            }
        }

        // 顯示下載成功提示
        function showDownloadSuccess(button) {
            const originalHTML = button.innerHTML;
            const originalBackground = button.style.backgroundColor;
            
            button.innerHTML = '<i class="fas fa-check"></i> 下載成功！';
            button.style.backgroundColor = '#2E7D32';
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.style.backgroundColor = originalBackground;
            }, 2000);
        }

        // 重新開始測驗
        function restartTest() {
            currentQuestionIndex = 0;
            userAnswers = {};
            advancedAnswers = {};
            showAdvanced = false;
            skinType = "";
            userResults = {};
            
            document.querySelector('.card').style.display = 'block';
            resultsContainer.style.display = 'none';
            resultsDownloadSection.style.display = 'none';
            linePromotionSection.style.display = 'none';
            
            toggleAdvancedBtn.innerHTML = '<i class="fas fa-plus-circle"></i><span>進階檢測（皮膚狀態分析）</span>';
            advancedQuestionsContainer.classList.remove('active');
            
            displayQuestion(currentQuestionIndex);
            updateProgress();
            generateBlessing();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
